name: Run PiT
on:
  workflow_dispatch:
  push:
jobs:
  run:
    runs-on: ubuntu-latest
    services:
      docker:
        image: docker:dind
        options: --privileged --shm-size=2g
    steps:
      - name: Check out branch
        uses: actions/checkout@v4
      - if: ${{ env.ACT }}
        name: ACT - install dependencies
        run: |
          echo "export PATH='$PATH'" > path.sh
          apt-get update
          apt-get install -y vim iputils-ping sudo unzip wget jq curl
      - uses: actions/setup-node@v4
        with:
          node-version: '18'
      - name: Set up Helm
        uses: azure/setup-helm@v3.5
      - name: Create k8s Kind Cluster
        uses: helm/kind-action@v1
        with:
          install_only: false
      - name: Run PiT
        env:
          CC_KEY: ${{ secrets.CC_KEY }}
          CC_CERT: ${{ secrets.CC_CERT }}
        run: |
          set
          ./scripts/pit/run.sh --starter=control-center



